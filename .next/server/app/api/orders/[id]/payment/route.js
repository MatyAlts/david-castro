"use strict";(()=>{var e={};e.id=774,e.ids=[774],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3898:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var a={};t.r(a),t.d(a,{POST:()=>p});var i=t(9303),n=t(8716),o=t(670),d=t(3493),s=t(7070);async function p(e,{params:r}){let{amount:t,method:a,isDeferred:i,accreditationDate:n}=await e.json(),o=await d._.$transaction(async e=>{let o=await e.payment.create({data:{orderId:r.id,amount:t,method:a,isDeferred:i||!1,accreditationDate:n?new Date(n):null}}),d=await e.order.findUnique({where:{id:r.id}});if(!d)throw Error("Order not found");let s=d.balance-t;return await e.order.update({where:{id:r.id},data:{balance:s,paid:s<=0}}),o});return s.NextResponse.json(o)}let u=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/orders/[id]/payment/route",pathname:"/api/orders/[id]/payment",filename:"route",bundlePath:"app/api/orders/[id]/payment/route"},resolvedPagePath:"C:\\Proyectos\\Imprenta\\app\\api\\orders\\[id]\\payment\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:m}=u,h="/api/orders/[id]/payment/route";function w(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},3493:(e,r,t)=>{t.d(r,{_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma||new a.PrismaClient({log:["query"]})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972],()=>t(3898));module.exports=a})();